name: PR Title & Folder Structure Check

on:
  pull_request_target:
    types: [opened, edited, synchronize, ready_for_review]

permissions:
  pull-requests: write
  contents: read

jobs:
  lint:
    if: ${{ !github.event.pull_request.draft }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const title = pr.title || "";
            const repo = context.repo;
            const headSha = pr.head.sha;

            // æ ‡é¢˜ï¼šHW{0..20} - {Name}ï¼ˆå¤§å°å†™ä¸æ•æ„Ÿï¼‰
            const titleRe = /^HW(0|[1-9]|1[0-9]|20)\s*-\s*\S.*$/i;

            // å›ºå®šé”šç‚¹ï¼Œé¿å…åˆ·å±
            const marker = '<!-- pr-hw-structure-lint -->';

            async function upsertComment(lines) {
              const body = [marker].concat(lines).join('\n');
              const { data: comments } = await github.rest.issues.listComments({
                owner: repo.owner, repo: repo.repo, issue_number: pr.number, per_page: 100,
              });
              const existing = comments.find(c => c.body && c.body.indexOf(marker) !== -1);
              if (existing) {
                await github.rest.issues.updateComment({
                  owner: repo.owner, repo: repo.repo, comment_id: existing.id, body,
                });
              } else {
                await github.rest.issues.createComment({
                  owner: repo.owner, repo: repo.repo, issue_number: pr.number, body,
                });
              }
            }

            async function cleanupComment() {
              const { data: comments } = await github.rest.issues.listComments({
                owner: repo.owner, repo: repo.repo, issue_number: pr.number, per_page: 100,
              });
              const existing = comments.find(c => c.body && c.body.indexOf(marker) !== -1);
              if (existing) {
                await github.rest.issues.deleteComment({
                  owner: repo.owner, repo: repo.repo, comment_id: existing.id,
                });
              }
            }

            async function fail(lines) {
              await upsertComment(lines);
              core.setFailed('PR title/folder structure check failed');
            }

            // --- 1) æ ‡é¢˜æ ¡éªŒ ---
            if (!titleRe.test(title)) {
              await fail([
                '### ğŸš« PR æ ‡é¢˜æ ¼å¼é”™è¯¯',
                '',
                'ä½ çš„æ ‡é¢˜ï¼š`' + title + '`',
                '',
                '**è¦æ±‚æ ¼å¼**ï¼š`HW{#} - {Nam
